 تمرین 9.2.1  این تمرین به بررسی **فاصله کسینوسی** (Cosine Distance) بین بردارهای مشخصه (Feature Vectors) کامپیوترها، با در نظر گرفتن فاکتورهای مقیاس‌بندی مختلف می‌پردازد. فاصله کسینوسی در فضاهایی که دارای ابعاد هستند، از جمله فضاهای اقلیدسی، کاربرد دارد و می‌تواند برای اندازه‌گیری شباهت بین اقلام یا کاربران در سیستم‌های توصیه‌گر استفاده شود.

**تعریف بردارهای مشخصه برای کامپیوترها:**
بر اساس مقادیر داده شده در جدول، بردارهای مشخصه برای هر کامپیوتر به شرح زیر است:
*   **کامپیوتر A**: [سرعت پردازنده: 3.06, حجم دیسک: 500, حجم حافظه اصلی: 6]
*   **کامپیوتر B**: [سرعت پردازنده: 2.68, حجم دیسک: 320, حجم حافظه اصلی: 4]
*   **کامپیوتر C**: [سرعت پردازنده: 2.92, حجم دیسک: 640, حجم حافظه اصلی: 6]

همانطور که در منبع اشاره شده است، اگر این اجزا مقیاس‌بندی نشوند، مولفه‌ی **حجم دیسک** به دلیل مقادیر بسیار بزرگتر خود نسبت به سایر مولفه‌ها، بر محاسبه‌ی شباهت غلبه خواهد کرد. بنابراین، فاکتورهای مقیاس‌بندی برای هر مولفه در نظر گرفته می‌شود:
*   سرعت پردازنده: 1
*   حجم دیسک: $\alpha$
*   حجم حافظه اصلی: $\beta$

بردارهای مقیاس‌بندی شده برای هر کامپیوتر:
*   **A_scaled** = $[3.06 \times 1, 500 \times \alpha, 6 \times \beta] = [3.06, 500\alpha, 6\beta]$
*   **B_scaled** = $[2.68 \times 1, 320 \times \alpha, 4 \times \beta] = [2.68, 320\alpha, 4\beta]$
*   **C_scaled** = $[2.92 \times 1, 640 \times \alpha, 6 \times \beta] = [2.92, 640\alpha, 6\beta]$

**فرمول‌های مورد نیاز:**
برای محاسبه **فاصله کسینوسی** بین دو بردار **x** و **y**، ابتدا **حاصل‌ضرب داخلی** (Dot Product) و **نُرم L2** (L2-norm) هر بردار را محاسبه می‌کنیم:

*   **حاصل‌ضرب داخلی:** $\mathbf{x} \cdot \mathbf{y} = \sum_{i=1}^{n} x_i y_i$
*   **نُرم L2:** $||\mathbf{x}|| = \sqrt{\sum_{i=1}^{n} x_i^2}$
*   **کسینوس زاویه بین دو بردار ($\theta$):** $\cos(\theta) = \frac{\mathbf{x} \cdot \mathbf{y}}{||\mathbf{x}|| \cdot ||\mathbf{y}||}$
*   **زاویه بر حسب درجه:** $\theta = \arccos(\cos(\theta)) \times \frac{180}{\pi}$

---

### **(a) محاسبه کسینوس زوایا بر حسب $\alpha$ و $\beta$:**

**1. برای جفت (A, B):**
*   **حاصل‌ضرب داخلی:**
    $\mathbf{A} \cdot \mathbf{B} = (3.06)(2.68) + (500\alpha)(320\alpha) + (6\beta)(4\beta)$
    $= 8.2008 + 160000\alpha^2 + 24\beta^2$
*   **نُرم A به توان 2:**
    $||\mathbf{A}||^2 = (3.06)^2 + (500\alpha)^2 + (6\beta)^2$
    $= 9.3636 + 250000\alpha^2 + 36\beta^2$
*   **نُرم B به توان 2:**
    $||\mathbf{B}||^2 = (2.68)^2 + (320\alpha)^2 + (4\beta)^2$
    $= 7.1824 + 102400\alpha^2 + 16\beta^2$
*   **کسینوس زاویه (A, B):**
    $\cos(\theta_{AB}) = \frac{8.2008 + 160000\alpha^2 + 24\beta^2}{\sqrt{(9.3636 + 250000\alpha^2 + 36\beta^2) \times (7.1824 + 102400\alpha^2 + 16\beta^2)}}$

**2. برای جفت (A, C):**
*   **حاصل‌ضرب داخلی:**
    $\mathbf{A} \cdot \mathbf{C} = (3.06)(2.92) + (500\alpha)(640\alpha) + (6\beta)(6\beta)$
    $= 8.9352 + 320000\alpha^2 + 36\beta^2$
*   **نُرم A به توان 2:** (همان بالا)
    $||\mathbf{A}||^2 = 9.3636 + 250000\alpha^2 + 36\beta^2$
*   **نُرم C به توان 2:**
    $||\mathbf{C}||^2 = (2.92)^2 + (640\alpha)^2 + (6\beta)^2$
    $= 8.5264 + 409600\alpha^2 + 36\beta^2$
*   **کسینوس زاویه (A, C):**
    $\cos(\theta_{AC}) = \frac{8.9352 + 320000\alpha^2 + 36\beta^2}{\sqrt{(9.3636 + 250000\alpha^2 + 36\beta^2) \times (8.5264 + 409600\alpha^2 + 36\beta^2)}}$

**3. برای جفت (B, C):**
*   **حاصل‌ضرب داخلی:**
    $\mathbf{B} \cdot \mathbf{C} = (2.68)(2.92) + (320\alpha)(640\alpha) + (4\beta)(6\beta)$
    $= 7.8256 + 204800\alpha^2 + 24\beta^2$
*   **نُرم B به توان 2:** (همان بالا)
    $||\mathbf{B}||^2 = 7.1824 + 102400\alpha^2 + 16\beta^2$
*   **نُرم C به توان 2:** (همان بالا)
    $||\mathbf{C}||^2 = 8.5264 + 409600\alpha^2 + 36\beta^2$
*   **کسینوس زاویه (B, C):**
    $\cos(\theta_{BC}) = \frac{7.8256 + 204800\alpha^2 + 24\beta^2}{\sqrt{(7.1824 + 102400\alpha^2 + 16\beta^2) \times (8.5264 + 409600\alpha^2 + 36\beta^2)}}$

---

### **(b) محاسبه زوایا اگر $\alpha = 1$ و $\beta = 1$:**

در این حالت، هیچ مقیاس‌بندی اعمال نمی‌شود و انتظار می‌رود که مولفه‌ی حجم دیسک (با مقادیر 500, 320, 640) بر محاسبات غلبه کند و منجر به زوایای بسیار کوچک (شباهت بالا) شود، حتی اگر در واقعیت کامپیوترها تفاوت‌های قابل توجهی داشته باشند.

**بردارهای مقیاس‌بندی شده:**
*   A_scaled = $[3.06, 500, 6]$
*   B_scaled = $[2.68, 320, 4]$
*   C_scaled = $[2.92, 640, 6]$

**1. برای جفت (A, B):**
*   $\mathbf{A} \cdot \mathbf{B} = 8.2008 + 160000 + 24 = 160032.2008$
*   $||\mathbf{A}|| = \sqrt{9.3636 + 250000 + 36} = \sqrt{250045.3636} \approx 500.045$
*   $||\mathbf{B}|| = \sqrt{7.1824 + 102400 + 16} = \sqrt{102423.1824} \approx 320.036$
*   $\cos(\theta_{AB}) = \frac{160032.2008}{500.045 \times 320.036} = \frac{160032.2008}{160033.911} \approx \mathbf{0.999989}$
*   $\theta_{AB} = \arccos(0.999989) \approx \mathbf{0.25 \text{ degrees}}$

**2. برای جفت (A, C):**
*   $\mathbf{A} \cdot \mathbf{C} = 8.9352 + 320000 + 36 = 320044.9352$
*   $||\mathbf{A}|| \approx 500.045$
*   $||\mathbf{C}|| = \sqrt{8.5264 + 409600 + 36} = \sqrt{409654.5264} \approx 640.042$
*   $\cos(\theta_{AC}) = \frac{320044.9352}{500.045 \times 640.042} = \frac{320044.9352}{320046.225} \approx \mathbf{0.9999959}$
*   $\theta_{AC} = \arccos(0.9999959) \approx \mathbf{0.17 \text{ degrees}}$

**3. برای جفت (B, C):**
*   $\mathbf{B} \cdot \mathbf{C} = 7.8256 + 204800 + 24 = 204831.8256$
*   $||\mathbf{B}|| \approx 320.036$
*   $||\mathbf{C}|| \approx 640.042$
*   $\cos(\theta_{BC}) = \frac{204831.8256}{320.036 \times 640.042} = \frac{204831.8256}{204832.88} \approx \mathbf{0.9999948}$
*   $\theta_{BC} = \arccos(0.9999948) \approx \mathbf{0.21 \text{ degrees}}$

**نتیجه‌گیری برای (b):**
همانطور که مشاهده می‌شود، بدون مقیاس‌بندی مناسب، تمام کسینوس‌های زاویه بسیار نزدیک به 1 و زوایا بسیار کوچک (نزدیک به 0 درجه) هستند. این نشان می‌دهد که تمامی کامپیوترها بسیار شبیه به هم به نظر می‌رسند، که به دلیل غلبه‌ی مولفه‌ی حجم دیسک در محاسبه‌ی نُرم و حاصل‌ضرب داخلی است.

---

### **(c) محاسبه زوایا اگر $\alpha = 0.01$ و $\beta = 0.5$:**

با اعمال این فاکتورهای مقیاس‌بندی، انتظار می‌رود که تأثیر مولفه‌های مختلف در محاسبه‌ی شباهت متعادل‌تر شود و تفاوت‌های واقعی بین کامپیوترها منعکس گردد.

**بردارهای مقیاس‌بندی شده:**
*   A_scaled = $[3.06, 500 \times 0.01, 6 \times 0.5] = [3.06, 5, 3]$
*   B_scaled = $[2.68, 320 \times 0.01, 4 \times 0.5] = [2.68, 3.2, 2]$
*   C_scaled = $[2.92, 640 \times 0.01, 6 \times 0.5] = [2.92, 6.4, 3]$

**1. برای جفت (A, B):**
*   $\mathbf{A} \cdot \mathbf{B} = (3.06)(2.68) + (5)(3.2) + (3)(2) = 8.2008 + 16 + 6 = 30.2008$
*   $||\mathbf{A}|| = \sqrt{(3.06)^2 + 5^2 + 3^2} = \sqrt{9.3636 + 25 + 9} = \sqrt{43.3636} \approx 6.585$
*   $||\mathbf{B}|| = \sqrt{(2.68)^2 + (3.2)^2 + 2^2} = \sqrt{7.1824 + 10.24 + 4} = \sqrt{21.4224} \approx 4.629$
*   $\cos(\theta_{AB}) = \frac{30.2008}{6.585 \times 4.629} = \frac{30.2008}{30.505} \approx \mathbf{0.990}$
*   $\theta_{AB} = \arccos(0.990) \approx \mathbf{8.11 \text{ degrees}}$

**2. برای جفت (A, C):**
*   $\mathbf{A} \cdot \mathbf{C} = (3.06)(2.92) + (5)(6.4) + (3)(3) = 8.9352 + 32 + 9 = 49.9352$
*   $||\mathbf{A}|| \approx 6.585$
*   $||\mathbf{C}|| = \sqrt{(2.92)^2 + (6.4)^2 + 3^2} = \sqrt{8.5264 + 40.96 + 9} = \sqrt{58.4864} \approx 7.648$
*   $\cos(\theta_{AC}) = \frac{49.9352}{6.585 \times 7.648} = \frac{49.9352}{50.407} \approx \mathbf{0.9906}$
*   $\theta_{AC} = \arccos(0.9906) \approx \mathbf{7.78 \text{ degrees}}$

**3. برای جفت (B, C):**
*   $\mathbf{B} \cdot \mathbf{C} = (2.68)(2.92) + (3.2)(6.4) + (2)(3) = 7.8256 + 20.48 + 6 = 34.3056$
*   $||\mathbf{B}|| \approx 4.629$
*   $||\mathbf{C}|| \approx 7.648$
*   $\cos(\theta_{BC}) = \frac{34.3056}{4.629 \times 7.648} = \frac{34.3056}{35.405} \approx \mathbf{0.9689}$
*   $\theta_{BC} = \arccos(0.9689) \approx \mathbf{14.39 \text{ degrees}}$

**نتیجه‌گیری برای (c):**
با اعمال فاکتورهای مقیاس‌بندی $\alpha = 0.01$ و $\beta = 0.5$، زوایا بزرگتر شده‌اند و تفاوت‌های بیشتری را بین جفت‌های کامپیوترها نشان می‌دهند. این امر منعکس‌کننده‌ی تأثیر متعادل‌تر هر مولفه‌ی مشخصه بر روی محاسبه‌ی شباهت است، به طوری که هیچ مولفه‌ای به تنهایی بر نتیجه غلبه نمی‌کند. این نشان می‌دهد که کامپیوترهای A و C (حدود 7.78 درجه) کمی شبیه‌تر از A و B (حدود 8.11 درجه) هستند، و B و C (حدود 14.39 درجه) کمترین شباهت را در بین این سه جفت دارند.




من می‌توانم در حل تمرینات بخش 9.3.4 با استفاده از ماتریس سودمندی که ارائه کرده‌اید، به شما کمک کنم. ماتریس سودمندی ارائه شده توسط شما به شرح زیر است:

| کاربر/آیتم | a | b | c | d | e | f | g | h |
|:----------|:--|:--|:--|:--|:--|:--|:--|:--|
| **A** | 4 | 5 | 0 | 5 | 1 | 0 | 3 | 2 |
| **B** | 0 | 3 | 4 | 3 | 1 | 2 | 1 | 0 |
| **C** | 2 | 0 | 1 | 3 | 0 | 4 | 5 | 3 |

نکته مهم این است که در ماتریس‌های سودمندی، "صفر" معمولاً به معنای رتبه‌بندی نشده (خالی) یا عدم ترجیح است. با توجه به متن تمرینات در منبع که به "blank" اشاره می‌کند، مقادیر صفر در ماتریس شما (مانند C=0 یا F=0 برای کاربر A) را برای قسمت‌های (الف) و (ب) به عنوان **خالی (Unrated)** در نظر می‌گیرم. اما برای قسمت‌های (ج) و (د) که قانون خاصی برای تبدیل رتبه‌ها به صفر و یک ارائه شده، طبق آن قانون عمل خواهم کرد.

---

### حل تمرین 9.3.1

**ماتریس سودمندی اولیه (با در نظر گرفتن 0 به عنوان خانه خالی):**

| کاربر/آیتم | a | b | c | d | e | f | g | h |
|:----------|:--|:--|:--|:--|:--|:--|:--|:--|
| **A** | 4 | 5 | - | 5 | 1 | - | 3 | 2 |
| **B** | - | 3 | 4 | 3 | 1 | 2 | 1 | - |
| **C** | 2 | - | 1 | 3 | - | 4 | 5 | 3 |

---

**(a) محاسبه فاصله ژاکارد بین هر جفت کاربر، با فرض ماتریس سودمندی به صورت بولی:**

ابتدا ماتریس را به صورت بولی (1 برای آیتم رتبه‌بندی شده، 0 برای آیتم رتبه‌بندی نشده) تبدیل می‌کنیم.

| کاربر/آیتم | a | b | c | d | e | f | g | h |
|:----------|:--|:--|:--|:--|:--|:--|:--|:--|
| **A** | 1 | 1 | 0 | 1 | 1 | 0 | 1 | 1 |
| **B** | 0 | 1 | 1 | 1 | 1 | 1 | 1 | 0 |
| **C** | 1 | 0 | 1 | 1 | 0 | 1 | 1 | 1 |

*   **کاربران A و B:**
    *   آیتم‌های رتبه‌بندی شده توسط A (مجموعه $C_A$): {a, b, d, e, g, h}
    *   آیتم‌های رتبه‌بندی شده توسط B (مجموعه $C_B$): {b, c, d, e, f, g}
    *   اشتراک $C_A \cap C_B$: {b, d, e, g} (اندازه = 4)
    *   اجتماع $C_A \cup C_B$: {a, b, c, d, e, f, g, h} (اندازه = 8)
    *   شباهت ژاکارد $sim(A,B) = |C_A \cap C_B| / |C_A \cup C_B| = 4/8 = 0.5$.
    *   **فاصله ژاکارد $d(A,B) = 1 - sim(A,B) = 1 - 0.5 = 0.5$**.

*   **کاربران A و C:**
    *   آیتم‌های رتبه‌بندی شده توسط A ($C_A$): {a, b, d, e, g, h}
    *   آیتم‌های رتبه‌بندی شده توسط C ($C_C$): {a, c, d, f, g, h}
    *   اشتراک $C_A \cap C_C$: {a, d, g, h} (اندازه = 4)
    *   اجتماع $C_A \cup C_C$: {a, b, c, d, e, f, g, h} (اندازه = 8)
    *   شباهت ژاکارد $sim(A,C) = 4/8 = 0.5$.
    *   **فاصله ژاکارد $d(A,C) = 1 - 0.5 = 0.5$**.

*   **کاربران B و C:**
    *   آیتم‌های رتبه‌بندی شده توسط B ($C_B$): {b, c, d, e, f, g}
    *   آیتم‌های رتبه‌بندی شده توسط C ($C_C$): {a, c, d, f, g, h}
    *   اشتراک $C_B \cap C_C$: {c, d, f, g} (اندازه = 4)
    *   اجتماع $C_B \cup C_C$: {a, b, c, d, e, f, g, h} (اندازه = 8)
    *   شباهت ژاکارد $sim(B,C) = 4/8 = 0.5$.
    *   **فاصله ژاکارد $d(B,C) = 1 - 0.5 = 0.5$**.

---

**(b) تکرار قسمت (الف) با استفاده از فاصله کسینوسی:**

برای محاسبه فاصله کسینوسی، بردارهای بولی کامل (با 0 برای آیتم‌های رتبه‌بندی نشده) استفاده می‌شوند. شباهت کسینوسی برابر است با حاصل ضرب داخلی دو بردار تقسیم بر حاصل ضرب اندازه (نرم) آن‌ها. فاصله کسینوسی برابر با $1 - \text{شباهت کسینوسی}$.

*   **کاربران A و B:**
    *   $V_A =$
    *   $V_B =$
    *   حاصل ضرب داخلی $V_A \cdot V_B = 4$.
    *   اندازه $||V_A|| = \sqrt{1^2+1^2+0^2+1^2+1^2+0^2+1^2+1^2} = \sqrt{6}$.
    *   اندازه $||V_B|| = \sqrt{0^2+1^2+1^2+1^2+1^2+1^2+1^2+0^2} = \sqrt{6}$.
    *   شباهت کسینوسی $sim(A,B) = \frac{4}{\sqrt{6} \cdot \sqrt{6}} = \frac{4}{6} \approx 0.6667$.
    *   **فاصله کسینوسی $d(A,B) = 1 - 0.6667 = 0.3333$**.

*   **کاربران A و C:**
    *   $V_A =$
    *   $V_C =$
    *   حاصل ضرب داخلی $V_A \cdot V_C = 4$.
    *   اندازه $||V_A|| = \sqrt{6}$.
    *   اندازه $||V_C|| = \sqrt{6}$.
    *   شباهت کسینوسی $sim(A,C) = \frac{4}{\sqrt{6} \cdot \sqrt{6}} = \frac{4}{6} \approx 0.6667$.
    *   **فاصله کسینوسی $d(A,C) = 1 - 0.6667 = 0.3333$**.

*   **کاربران B و C:**
    *   $V_B =$
    *   $V_C =$
    *   حاصل ضرب داخلی $V_B \cdot V_C = 4$.
    *   اندازه $||V_B|| = \sqrt{6}$.
    *   اندازه $||V_C|| = \sqrt{6}$.
    *   شباهت کسینوسی $sim(B,C) = \frac{4}{\sqrt{6} \cdot \sqrt{6}} = \frac{4}{6} \approx 0.6667$.
    *   **فاصله کسینوسی $d(B,C) = 1 - 0.6667 = 0.3333$**.

---

**(c) رتبه‌بندی‌های 3، 4، و 5 را 1 و 1، 2، و خانه‌های خالی را 0 در نظر بگیرید. فاصله ژاکارد را بین هر جفت کاربر محاسبه کنید.**

ماتریس بولی جدید (بر اساس مقدار رتبه‌بندی):

| کاربر/آیتم | a | b | c | d | e | f | g | h |
|:----------|:--|:--|:--|:--|:--|:--|:--|:--|
| **A** | 1 (4) | 1 (5) | 0 (0) | 1 (5) | 0 (1) | 0 (0) | 1 (3) | 0 (2) |
| **B** | 0 (0) | 1 (3) | 1 (4) | 1 (3) | 0 (1) | 0 (2) | 0 (1) | 0 (0) |
| **C** | 0 (2) | 0 (0) | 0 (1) | 1 (3) | 0 (0) | 1 (4) | 1 (5) | 1 (3) |

*   **کاربران A و B:**
    *   آیتم‌های دارای 1 برای A ($S_A$): {a, b, d, g}
    *   آیتم‌های دارای 1 برای B ($S_B$): {b, c, d}
    *   اشتراک $S_A \cap S_B$: {b, d} (اندازه = 2)
    *   اجتماع $S_A \cup S_B$: {a, b, c, d, g} (اندازه = 5)
    *   شباهت ژاکارد $sim(A,B) = 2/5 = 0.4$.
    *   **فاصله ژاکارد $d(A,B) = 1 - 0.4 = 0.6$**.

*   **کاربران A و C:**
    *   آیتم‌های دارای 1 برای A ($S_A$): {a, b, d, g}
    *   آیتم‌های دارای 1 برای C ($S_C$): {d, f, g, h}
    *   اشتراک $S_A \cap S_C$: {d, g} (اندازه = 2)
    *   اجتماع $S_A \cup S_C$: {a, b, d, f, g, h} (اندازه = 6)
    *   شباهت ژاکارد $sim(A,C) = 2/6 \approx 0.3333$.
    *   **فاصله ژاکارد $d(A,C) = 1 - 0.3333 = 0.6667$**.

*   **کاربران B و C:**
    *   آیتم‌های دارای 1 برای B ($S_B$): {b, c, d}
    *   آیتم‌های دارای 1 برای C ($S_C$): {d, f, g, h}
    *   اشتراک $S_B \cap S_C$: {d} (اندازه = 1)
    *   اجتماع $S_B \cup S_C$: {b, c, d, f, g, h} (اندازه = 6)
    *   شباهت ژاکارد $sim(B,C) = 1/6 \approx 0.1667$.
    *   **فاصله ژاکارد $d(B,C) = 1 - 0.1667 = 0.8333$**.

---

**(d) تکرار قسمت (ج) با استفاده از فاصله کسینوسی:**

بردارهای بولی جدید (با 0 به عنوان مولفه صریح):

| کاربر/آیتم | a | b | c | d | e | f | g | h |
|:----------|:--|:--|:--|:--|:--|:--|:--|:--|
| **A** | 1 | 1 | 0 | 1 | 0 | 0 | 1 | 0 |
| **B** | 0 | 1 | 1 | 1 | 0 | 0 | 0 | 0 |
| **C** | 0 | 0 | 0 | 1 | 0 | 1 | 1 | 1 |

*   **کاربران A و B:**
    *   $V_A' =$
    *   $V_B' =$
    *   حاصل ضرب داخلی $V_A' \cdot V_B' = (1*0) + (1*1) + (0*1) + (1*1) + (0*0) + (0*0) + (1*0) + (0*0) = 2$.
    *   اندازه $||V_A'|| = \sqrt{1^2+1^2+0^2+1^2+0^2+0^2+1^2+0^2} = \sqrt{4} = 2$.
    *   اندازه $||V_B'|| = \sqrt{0^2+1^2+1^2+1^2+0^2+0^2+0^2+0^2} = \sqrt{3} \approx 1.732$.
    *   شباهت کسینوسی $sim(A,B) = \frac{2}{2 \cdot 1.732} = \frac{2}{3.464} \approx 0.5774$.
    *   **فاصله کسینوسی $d(A,B) = 1 - 0.5774 = 0.4226$**.

*   **کاربران A و C:**
    *   $V_A' =$
    *   $V_C' =$
    *   حاصل ضرب داخلی $V_A' \cdot V_C' = (1*0) + (1*0) + (0*0) + (1*1) + (0*0) + (0*1) + (1*1) + (0*1) = 2$.
    *   اندازه $||V_A'|| = 2$.
    *   اندازه $||V_C'|| = \sqrt{0^2+0^2+0^2+1^2+0^2+1^2+1^2+1^2} = \sqrt{4} = 2$.
    *   شباهت کسینوسی $sim(A,C) = \frac{2}{2 \cdot 2} = \frac{2}{4} = 0.5$.
    *   **فاصله کسینوسی $d(A,C) = 1 - 0.5 = 0.5$**.

*   **کاربران B و C:**
    *   $V_B' =$
    *   $V_C' =$
    *   حاصل ضرب داخلی $V_B' \cdot V_C' = (0*0) + (1*0) + (1*0) + (1*1) + (0*0) + (0*1) + (0*1) + (0*1) = 1$.
    *   اندازه $||V_B'|| = \sqrt{3}$.
    *   اندازه $||V_C'|| = 2$.
    *   شباهت کسینوسی $sim(B,C) = \frac{1}{\sqrt{3} \cdot 2} = \frac{1}{3.464} \approx 0.2887$.
    *   **فاصله کسینوسی $d(B,C) = 1 - 0.2887 = 0.7113$**.

---

**(e) نرمال‌سازی ماتریس با کسر میانگین امتیاز هر کاربر از هر ورودی غیرخالی آن کاربر:**

میانگین رتبه‌بندی‌های هر کاربر (فقط آیتم‌های رتبه‌بندی شده):
*   **کاربر A:** رتبه‌ها: {4, 5, 5, 1, 3, 2}. مجموع = 20. تعداد = 6. میانگین = $20/6 \approx 3.333$.
*   **کاربر B:** رتبه‌ها: {3, 4, 3, 1, 2, 1}. مجموع = 14. تعداد = 6. میانگین = $14/6 \approx 2.333$.
*   **کاربر C:** رتبه‌ها: {2, 1, 3, 4, 5, 3}. مجموع = 18. تعداد = 6. میانگین = $18/6 = 3.0$.

**ماتریس نرمال‌سازی شده (مقدار اصلی - میانگین کاربر):**

| کاربر/آیتم | a | b | c | d | e | f | g | h |
|:----------|:--|:--|:--|:--|:--|:--|:--|:--|
| **A** | $4-3.333=\mathbf{0.667}$ | $5-3.333=\mathbf{1.667}$ | - | $5-3.333=\mathbf{1.667}$ | $1-3.333=\mathbf{-2.333}$ | - | $3-3.333=\mathbf{-0.333}$ | $2-3.333=\mathbf{-1.333}$ |
| **B** | - | $3-2.333=\mathbf{0.667}$ | $4-2.333=\mathbf{1.667}$ | $3-2.333=\mathbf{0.667}$ | $1-2.333=\mathbf{-1.333}$ | $2-2.333=\mathbf{-0.333}$ | $1-2.333=\mathbf{-1.333}$ | - |
| **C** | $2-3.0=\mathbf{-1.0}$ | - | $1-3.0=\mathbf{-2.0}$ | $3-3.0=\mathbf{0.0}$ | - | $4-3.0=\mathbf{1.0}$ | $5-3.0=\mathbf{2.0}$ | $3-3.0=\mathbf{0.0}$ |

---

**(f) با استفاده از ماتریس نرمال‌شده از قسمت (ه)، فاصله کسینوسی را بین هر جفت کاربر محاسبه کنید.**

فقط آیتم‌هایی که توسط هر دو کاربر در یک جفت رتبه‌بندی شده‌اند (غیر خالی هستند) در نظر گرفته می‌شوند.

*   **کاربران A و B:** آیتم‌های مشترک رتبه‌بندی شده: {b, d, e, g}
    *   بردارهای مشترک: $V_A'' = [1.667, 1.667, -2.333, -0.333]$ و $V_B'' = [0.667, 0.667, -1.333, -1.333]$
    *   حاصل ضرب داخلی $V_A'' \cdot V_B'' = (1.667 \times 0.667) + (1.667 \times 0.667) + (-2.333 \times -1.333) + (-0.333 \times -1.333) \approx 1.1115 + 1.1115 + 3.1099 + 0.4435 = 5.7764$.
    *   اندازه $||V_A''|| = \sqrt{1.667^2+1.667^2+(-2.333)^2+(-0.333)^2} = \sqrt{2.7789+2.7789+5.4429+0.1109} = \sqrt{11.1116} \approx 3.333$.
    *   اندازه $||V_B''|| = \sqrt{0.667^2+0.667^2+(-1.333)^2+(-1.333)^2} = \sqrt{0.4449+0.4449+1.7769+1.7769} = \sqrt{4.4436} \approx 2.108$.
    *   شباهت کسینوسی $sim(A,B) = \frac{5.7764}{3.333 \cdot 2.108} \approx \frac{5.7764}{7.026} \approx 0.8222$.
    *   **فاصله کسینوسی $d(A,B) = 1 - 0.8222 = 0.1778$**.

*   **کاربران A و C:** آیتم‌های مشترک رتبه‌بندی شده: {a, d, g, h}
    *   بردارهای مشترک: $V_A'' = [0.667, 1.667, -0.333, -1.333]$ و $V_C'' = [-1.0, 0.0, 2.0, 0.0]$
    *   حاصل ضرب داخلی $V_A'' \cdot V_C'' = (0.667 \times -1.0) + (1.667 \times 0.0) + (-0.333 \times 2.0) + (-1.333 \times 0.0) \approx -0.667 + 0.0 - 0.666 + 0.0 = -1.333$.
    *   اندازه $||V_A''|| = \sqrt{0.667^2+1.667^2+(-0.333)^2+(-1.333)^2} = \sqrt{0.4449+2.7789+0.1109+1.7769} = \sqrt{5.1116} \approx 2.261$.
    *   اندازه $||V_C''|| = \sqrt{(-1.0)^2+0.0^2+2.0^2+0.0^2} = \sqrt{1.0+0.0+4.0+0.0} = \sqrt{5.0} \approx 2.236$.
    *   شباهت کسینوسی $sim(A,C) = \frac{-1.333}{2.261 \cdot 2.236} \approx \frac{-1.333}{5.056} \approx -0.2636$.
    *   **فاصله کسینوسی $d(A,C) = 1 - (-0.2636) = 1.2636$**.

*   **کاربران B و C:** آیتم‌های مشترک رتبه‌بندی شده: {c, d, f, g}
    *   بردارهای مشترک: $V_B'' = [1.667, 0.667, -0.333, -1.333]$ و $V_C'' = [-2.0, 0.0, 1.0, 2.0]$
    *   حاصل ضرب داخلی $V_B'' \cdot V_C'' = (1.667 \times -2.0) + (0.667 \times 0.0) + (-0.333 \times 1.0) + (-1.333 \times 2.0) \approx -3.334 + 0.0 - 0.333 - 2.666 = -6.333$.
    *   اندازه $||V_B''|| = \sqrt{1.667^2+0.667^2+(-0.333)^2+(-1.333)^2} = \sqrt{2.7789+0.4449+0.1109+1.7769} = \sqrt{5.1116} \approx 2.261$.
    *   اندازه $||V_C''|| = \sqrt{(-2.0)^2+0.0^2+1.0^2+2.0^2} = \sqrt{4.0+0.0+1.0+4.0} = \sqrt{9.0} = 3.0$.
    *   شباهت کسینوسی $sim(B,C) = \frac{-6.333}{2.261 \cdot 3.0} \approx \frac{-6.333}{6.783} \approx -0.9337$.
    *   **فاصله کسینوسی $d(B,C) = 1 - (-0.9337) = 1.9337$**.

---

### حل تمرین 9.3.2

**(a) خوشه‌بندی سلسله‌مراتبی هشت آیتم به چهار خوشه:**

**مرحله 1: تبدیل ماتریس به بولی بر اساس رتبه‌ها:**
رتبه‌های 3، 4، 5 به 1 و رتبه‌های 1، 2 و خانه‌های خالی (صفرها) به 0 تبدیل می‌شوند.

| کاربر/آیتم | a | b | c | d | e | f | g | h |
|:----------|:--|:--|:--|:--|:--|:--|:--|:--|
| **A** | 1 | 1 | 0 | 1 | 0 | 0 | 1 | 0 |
| **B** | 0 | 1 | 1 | 1 | 0 | 0 | 0 | 0 |
| **C** | 0 | 0 | 0 | 1 | 0 | 1 | 1 | 1 |

اکنون آیتم‌ها را به عنوان مجموعه‌هایی از کاربران در نظر می‌گیریم که به آن‌ها رتبه "1" (بالا) داده‌اند:
*   $I_a = \{A\}$
*   $I_b = \{A, B\}$
*   $I_c = \{B\}$
*   $I_d = \{A, B, C\}$
*   $I_e = \{\}$ (مجموعه خالی)
*   $I_f = \{C\}$
*   $I_g = \{A, C\}$
*   $I_h = \{C\}$

**مرحله 2: محاسبه فواصل ژاکارد بین تمام جفت آیتم‌ها:**
فرمول فاصله ژاکارد $d(S_1, S_2) = 1 - \frac{|S_1 \cap S_2|}{|S_1 \cup S_2|}$.

کوچکترین فواصل اولیه:
*   $d(I_f, I_h) = 1 - \frac{|\{C\}|}{|\{C\}|} = 1 - 1 = \mathbf{0}$
*   $d(I_b, I_d) = 1 - \frac{|\{A,B\}|}{|\{A,B,C\}|} = 1 - 2/3 \approx \mathbf{0.333}$
*   $d(I_d, I_g) = 1 - \frac{|\{A,C\}|}{|\{A,B,C\}|} = 1 - 2/3 \approx \mathbf{0.333}$

**مرحله 3: خوشه‌بندی سلسله‌مراتبی (هدف: 4 خوشه):**

1.  **خوشه‌های اولیه:** {a}, {b}, {c}, {d}, {e}, {f}, {g}, {h} (8 خوشه)

2.  **ادغام {f} و {h} (کمترین فاصله = 0):**
    *   خوشه‌ها: {a}, {b}, {c}, {d}, {e}, **{f,h}**, {g} (7 خوشه)
    *   مجموعه معادل برای {f,h} همان $I_f \cup I_h = \{C\}$ است.
    *   فواصل جدید برای خوشه {f,h} محاسبه می‌شوند (کوچکترین فاصله بین اعضای خوشه جدید و اعضای خوشه دیگر). به عنوان مثال، $d(\{f,h\}, c) = \min(d(I_f, I_c), d(I_h, I_c)) = \min(1, 0.5) = 0.5$.

3.  **ادغام {b} و {d} (کمترین فاصله = 0.333):**
    *   خوشه‌ها: {a}, {c}, {e}, {f,h}, {g}, **{b,d}** (6 خوشه)
    *   مجموعه معادل برای {b,d} همان $I_b \cup I_d = \{A, B, C\}$ است.
    *   به عنوان مثال، $d(\{b,d\}, g) = \min(d(I_b, I_g), d(I_d, I_g)) = \min(0.667, 0.333) = 0.333$.

4.  **ادغام {b,d} و {g} (کمترین فاصله = 0.333):**
    *   خوشه‌ها: {a}, {c}, {e}, {f,h}, **{b,d,g}** (5 خوشه)
    *   مجموعه معادل برای {b,d,g} همان $I_b \cup I_d \cup I_g = \{A, B, C\}$ است.
    *   به عنوان مثال، $d(\{b,d,g\}, a) = \min(d(I_b, I_a), d(I_d, I_a), d(I_g, I_a)) = \min(0.5, 0.667, 0.5) = 0.5$.

5.  **ادغام {f,h} و {b,d,g} (کمترین فاصله = 0.5):**
    *   در این مرحله چندین جفت با فاصله 0.5 وجود دارد:
        *   ({a}, {b,d,g}) با فاصله 0.5 (زیرا $d(I_a, I_b) = 0.5$ و $d(I_a, I_g) = 0.5$)
        *   ({c}, {b,d,g}) با فاصله 0.5 (زیرا $d(I_c, I_b) = 0.5$)
        *   ({c}, {f,h}) با فاصله 0.5 (زیرا $d(I_c, I_h) = 0.5$)
        *   ({f,h}, {b,d,g}) با فاصله 0.5 (زیرا $d(I_f, I_g) = 0.5$ و $d(I_h, I_g) = 0.5$)
    *   با انتخاب اختیاری **{f,h} و {b,d,g}** (که بیشترین آیتم‌ها را شامل می‌شوند) برای ادغام:
    *   خوشه‌های نهایی: {a}, {c}, {e}, **{b,d,f,g,h}** (4 خوشه)
        *   (مجموعه معادل برای {b,d,f,g,h} همچنان $\{A,B,C\}$ است.)

**خوشه‌های نهایی شکل‌گرفته: {a}, {c}, {e}, {b,d,f,g,h}**

---
