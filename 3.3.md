بسیار خوب، بیایید تمرین 3.3.2 را با استفاده از داده‌ها و الگوریتم توضیح داده شده در منابع حل کنیم. این تمرین از ما می‌خواهد که امضای Minhash برای ستون‌های ماتریس شکل 3.2 را، با استفاده از دو تابع هش اضافی h3(x) و h4(x) علاوه بر h1(x) و h2(x) که قبلاً در منبع معرفی شده‌اند، محاسبه کنیم.

ماتریس مورد نظر در شکل 3.2 نشان داده شده است و در شکل 3.4 با شماره‌گذاری سطرها از 0 تا 4 و مقادیر توابع هش h1 و h2 آورده شده است. سطرها با حروف a, b, c, d, e در شکل 3.2 متناظر با سطر‌های 0, 1, 2, 3, 4 در شکل 3.4 هستند.

**ماتریس از شکل 3.4 با شماره‌گذاری سطرها:**

| Element | S1 | S2 | S3 | S4 |
| :------ | :- | :- | :- | :- |
| 0 (a)   | 1  | 0  | 0  | 1  |
| 1 (b)   | 0  | 0  | 1  | 0  |
| 2 (c)   | 0  | 1  | 0  | 1  |
| 3 (d)   | 1  | 0  | 1  | 1  |
| 4 (e)   | 0  | 0  | 1  | 0  |

توابع هش اضافی داده شده عبارتند از:
(a) h3(x) = 2x + 4 mod 5
(b) h4(x) = 3x − 1 mod 5

برای محاسبه امضای Minhash، ما از الگوریتم یک‌گذره (one-pass implementation) استفاده می‌کنیم که در منبع توضیح داده شده است. در این روش، ما سطرها را به ترتیب داده شده (از 0 تا 4) اسکن می‌کنیم. یک ماتریس امضا `SIG` با ابعاد `[تعداد توابع هش] × [تعداد ستون‌ها]` نگهداری می‌کنیم که ابتدا تمام درایه‌های آن ∞ هستند. وقتی به یک سطر `r` می‌رسیم که در ستون `c` مقدار 1 دارد، برای هر تابع هش `hi`، مقدار `SIG(i, c)` را با `hi(r)` مقایسه کرده و کوچکترین آن را انتخاب می‌کنیم.

ابتدا، مقادیر h3(x) و h4(x) را برای هر سطر x ∈ {0, 1, 2, 3, 4} محاسبه می‌کنیم:

*   **h3(x) = (2x + 4) mod 5:**
    *   h3(0) = (2\*0 + 4) mod 5 = 4 mod 5 = **4**
    *   h3(1) = (2\*1 + 4) mod 5 = 6 mod 5 = **1**
    *   h3(2) = (2\*2 + 4) mod 5 = 8 mod 5 = **3**
    *   h3(3) = (2\*3 + 4) mod 5 = 10 mod 5 = **0**
    *   h3(4) = (2\*4 + 4) mod 5 = 12 mod 5 = **2**

*   **h4(x) = (3x - 1) mod 5:**
    *   h4(0) = (3\*0 - 1) mod 5 = -1 mod 5 = **4**
    *   h4(1) = (3\*1 - 1) mod 5 = 2 mod 5 = **2**
    *   h4(2) = (3\*2 - 1) mod 5 = 5 mod 5 = **0**
    *   h4(3) = (3\*3 - 1) mod 5 = 8 mod 5 = **3**
    *   h4(4) = (3\*4 - 1) mod 5 = 11 mod 5 = **1**

اکنون، ماتریس امضا را برای چهار تابع هش h1, h2, h3, h4 و چهار ستون S1, S2, S3, S4 با دنبال کردن سطرها محاسبه می‌کنیم.

**ماتریس امضای اولیه (همه ∞):**

|     | S1 | S2 | S3 | S4 |
| :-- | :- | :- | :- | :- |
| h1  | ∞  | ∞  | ∞  | ∞  |
| h2  | ∞  | ∞  | ∞  | ∞  |
| h3  | ∞  | ∞  | ∞  | ∞  |
| h4  | ∞  | ∞  | ∞  | ∞  |

**پردازش سطر 0:** ستون‌های S1 و S4 در سطر 0 دارای 1 هستند. مقادیر هش برای سطر 0: h1(0)=1, h2(0)=1, h3(0)=4, h4(0)=4.
*   برای S1: SIG(h1, S1) = min(∞, 1)=1, SIG(h2, S1)=min(∞, 1)=1, SIG(h3, S1)=min(∞, 4)=4, SIG(h4, S1)=min(∞, 4)=4.
*   برای S4: SIG(h1, S4) = min(∞, 1)=1, SIG(h2, S4)=min(∞, 1)=1, SIG(h3, S4)=min(∞, 4)=4, SIG(h4, S4)=min(∞, 4)=4.

**ماتریس امضا پس از سطر 0:**

|     | S1 | S2 | S3 | S4 |
| :-- | :- | :- | :- | :- |
| h1  | 1  | ∞  | ∞  | 1  |
| h2  | 1  | ∞  | ∞  | 1  |
| h3  | 4  | ∞  | ∞  | 4  |
| h4  | 4  | ∞  | ∞  | 4  |

**پردازش سطر 1:** ستون S3 در سطر 1 دارای 1 است. مقادیر هش برای سطر 1: h1(1)=2, h2(1)=4, h3(1)=1, h4(1)=2.
*   برای S3: SIG(h1, S3) = min(∞, 2)=2, SIG(h2, S3)=min(∞, 4)=4, SIG(h3, S3)=min(∞, 1)=1, SIG(h4, S3)=min(∞, 2)=2.

**ماتریس امضا پس از سطر 1:**

|     | S1 | S2 | S3 | S4 |
| :-- | :- | :- | :- | :- |
| h1  | 1  | ∞  | 2  | 1  |
| h2  | 1  | ∞  | 4  | 1  |
| h3  | 4  | ∞  | 1  | 4  |
| h4  | 4  | ∞  | 2  | 4  |

**پردازش سطر 2:** ستون‌های S2 و S4 در سطر 2 دارای 1 هستند. مقادیر هش برای سطر 2: h1(2)=3, h2(2)=2, h3(2)=3, h4(2)=0.
*   برای S2: SIG(h1, S2)=min(∞, 3)=3, SIG(h2, S2)=min(∞, 2)=2, SIG(h3, S2)=min(∞, 3)=3, SIG(h4, S2)=min(∞, 0)=0.
*   برای S4: SIG(h1, S4)=min(1, 3)=1, SIG(h2, S4)=min(1, 2)=1, SIG(h3, S4)=min(4, 3)=3, SIG(h4, S4)=min(4, 0)=0.

**ماتریس امضا پس از سطر 2:**

|     | S1 | S2 | S3 | S4 |
| :-- | :- | :- | :- | :- |
| h1  | 1  | 3  | 2  | 1  |
| h2  | 1  | 2  | 4  | 1  |
| h3  | 4  | 3  | 1  | 3  |
| h4  | 4  | 0  | 2  | 0  |

**پردازش سطر 3:** ستون‌های S1, S3 و S4 در سطر 3 دارای 1 هستند. مقادیر هش برای سطر 3: h1(3)=4, h2(3)=0, h3(3)=0, h4(3)=3.
*   برای S1: SIG(h1, S1)=min(1, 4)=1, SIG(h2, S1)=min(1, 0)=0, SIG(h3, S1)=min(4, 0)=0, SIG(h4, S1)=min(4, 3)=3.
*   برای S3: SIG(h1, S3)=min(2, 4)=2, SIG(h2, S3)=min(4, 0)=0, SIG(h3, S3)=min(1, 0)=0, SIG(h4, S3)=min(2, 3)=2.
*   برای S4: SIG(h1, S4)=min(1, 4)=1, SIG(h2, S4)=min(1, 0)=0, SIG(h3, S4)=min(3, 0)=0, SIG(h4, S4)=min(0, 3)=0.

**ماتریس امضا پس از سطر 3:**

|     | S1 | S2 | S3 | S4 |
| :-- | :- | :- | :- | :- |
| h1  | 1  | 3  | 2  | 1  |
| h2  | 0  | 2  | 0  | 0  |
| h3  | 0  | 3  | 0  | 0  |
| h4  | 3  | 0  | 2  | 0  |

**پردازش سطر 4:** ستون‌های S3 و S4 در سطر 4 دارای 1 هستند. مقادیر هش برای سطر 4: h1(4)=0, h2(4)=3, h3(4)=2, h4(4)=1.
*   برای S3: SIG(h1, S3)=min(2, 0)=0, SIG(h2, S3)=min(0, 3)=0, SIG(h3, S3)=min(0, 2)=0, SIG(h4, S3)=min(2, 1)=1.
*   برای S4: SIG(h1, S4)=min(1, 0)=0, SIG(h2, S4)=min(0, 3)=0, SIG(h3, S4)=min(0, 2)=0, SIG(h4, S4)=min(0, 1)=0.

**ماتریس امضای نهایی (شامل h1, h2, h3, h4):**

|     | **S1** | **S2** | **S3** | **S4** |
| :-- | :----- | :----- | :----- | :----- |
| **h1** | 1      | 3      | 0      | 0      |
| **h2** | 0      | 2      | 0      | 0      |
| **h3** | 0      | 3      | 0      | 0      |
| **h4** | 3      | 0      | 1      | 0      |

این ماتریس امضای نهایی برای ستون‌های S1، S2، S3، S4 با استفاده از توابع هش h1، h2، h3، و h4 است. توجه داشته باشید که مقادیر برای h1 و h2 در ستون‌های S1 و S2 در این ماتریس با ماتریس نهایی در مثال 3.8 منبع متفاوت است (SIG(h1, S1)=1، SIG(h2, S1)=0 در هر دو؛ SIG(h1, S2)=3، SIG(h2, S2)=2 در هر دو). اما برای S3 و S4 تفاوت وجود دارد (SIG(h1, S3)=0 در محاسبات ما، 2 در؛ SIG(h1, S4)=0 در محاسبات ما، 1 در و غیره).

بیایید مرحله 4 را دوباره برای S3 و S4 با دقت بیشتری بررسی کنیم، زیرا این مرحله باعث تغییر در نتایج h1 و h2 نسبت به مثال 3.8 شده است.

**ماتریس امضا پس از سطر 3 (بازبینی):**

|     | S1 | S2 | S3 | S4 |
| :-- | :- | :- | :- | :- |
| h1  | 1  | 3  | 2  | 1  |
| h2  | 0  | 2  | 0  | 0  |
| h3  | 0  | 3  | 0  | 0  |
| h4  | 3  | 0  | 2  | 0  |

**پردازش سطر 4:** ستون‌های S3 و S4 در سطر 4 دارای 1 هستند. مقادیر هش برای سطر 4: h1(4)=0, h2(4)=3, h3(4)=2, h4(4)=1.
*   برای S3:
    *   SIG(h1, S3) = min(2, **0**) = **0**. (قبلی 2 بود)
    *   SIG(h2, S3) = min(0, 3) = **0**. (قبلی 0 بود)
    *   SIG(h3, S3) = min(0, 2) = **0**. (قبلی 0 بود)
    *   SIG(h4, S3) = min(2, **1**) = **1**. (قبلی 2 بود)
*   برای S4:
    *   SIG(h1, S4) = min(1, **0**) = **0**. (قبلی 1 بود)
    *   SIG(h2, S4) = min(0, 3) = **0**. (قبلی 0 بود)
    *   SIG(h3, S4) = min(0, 2) = **0**. (قبلی 0 بود)
    *   SIG(h4, S4) = min(0, **1**) = **0**. (قبلی 0 بود)

**ماتریس امضای نهایی (با اصلاح سطر 4):**

|     | **S1** | **S2** | **S3** | **S4** |
| :-- | :----- | :----- | :----- | :----- |
| **h1** | 1      | 3      | **0**  | **0**  |
| **h2** | 0      | 2      | **0**  | **0**  |
| **h3** | 0      | 3      | **0**  | **0**  |
| **h4** | 3      | 0      | **1**  | **0**  |

این ماتریس نهایی، امضاهای Minhash برای هر ستون با استفاده از توابع هش h1، h2، h3 و h4 را نشان می‌دهد. ستون‌ها (امضاها) عبارتند از:
*   S1:<sup>T</sup>
*   S2:<sup>T</sup>
*   S3:<sup>T</sup>
*   S4: <sup>T</sup>

**توجه:** همانطور که در مثال 3.8 منبع اشاره شده، این مثال بسیار کوچک است و امضاهای Minhash ممکن است تخمین دقیقی از شباهت جاکارد ارائه ندهند. هدف این تمرین صرفاً محاسبه امضاها بر اساس توابع هش داده شده و ماتریس مشخص است.