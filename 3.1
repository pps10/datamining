
---

### **تمرین‌های صفحه 77، بخش 3.1: تشخیص تشابه (Similarity Detection)**

#### **3.1.1**
فرض کنید که شما از تکنیک‌های Minhash استفاده می‌کنید و از 20 تابع هش (hash function) برای هر مجموعه استفاده می‌کنید. دو مجموعه $A$ و $B$ را در نظر بگیرید که هر دو دارای 100 عنصر هستند.

* **الف) اگر Jaccard Similarity (تشابه جاکارد) بین $A$ و $B$ دقیقاً 0.5 باشد، احتمال اینکه تخمین Minhash شما دقیقاً 0.5 باشد چقدر است؟**

    **پاسخ:**
    تعداد توابع هش ($k$) برابر با 20 است.
    تشابه جاکارد ($J(A, B)$ یا $s$) برابر با 0.5 است.

    تخمین Minhash از شباهت جاکارد به صورت $\frac{X}{k}$ تعریف می‌شود که در آن $X$ تعداد توابع هشی است که Minhash آنها برای هر دو مجموعه $A$ و $B$ یکسان است.
    ما می‌خواهیم $\frac{X}{k} = 0.5$ باشد، که به این معنی است:
    $$\frac{X}{20} = 0.5 \implies X = 10$$

    هر تابع هش به عنوان یک آزمایش برنولی مستقل عمل می‌کند که با احتمال $s = J(A, B)$ "موفق" می‌شود (یعنی مقادیر Minhash یکسانی برای $A$ و $B$ تولید می‌کند).
    بنابراین، $X$ از توزیع دوجمله‌ای با پارامترهای $n=k=20$ و $p=s=0.5$ پیروی می‌کند: $X \sim B(n=20, p=0.5)$.

    احتمال اینکه $X$ دقیقاً 10 باشد، با استفاده از فرمول توزیع دوجمله‌ای محاسبه می‌شود:
    $$P(X=10) = \binom{n}{X} p^X (1-p)^{n-X}$$   $$P(X=10) = \binom{20}{10} (0.5)^{10} (1-0.5)^{20-10}$$   $$P(X=10) = \binom{20}{10} (0.5)^{10} (0.5)^{10}$$   $$P(X=10) = \binom{20}{10} (0.5)^{20}$$
    با محاسبه مقادیر:
    $$\binom{20}{10} = \frac{20!}{10!10!} = 184756$$   $$(0.5)^{20} = \frac{1}{2^{20}} = \frac{1}{1048576} \approx 0.000000953674$$
    بنابراین:
    $$P(X=10) = 184756 \times \frac{1}{1048576} \approx 0.176197$$

* **ب) اگر تشابه جاکارد بین $A$ و $B$ دقیقاً 0.5 باشد، احتمال اینکه تخمین Minhash شما کمتر از 0.4 یا بیشتر از 0.6 باشد چقدر است؟**

    **پاسخ:**
    ما به دنبال احتمال $P\left(\frac{X}{k} < 0.4 \text{ یا } \frac{X}{k} > 0.6\right)$ هستیم.
    با جایگذاری $k=20$:
    $$\frac{X}{20} < 0.4 \implies X < 8$$   $$\frac{X}{20} > 0.6 \implies X > 12$$
    پس، ما باید $P(X < 8 \text{ یا } X > 12)$ را محاسبه کنیم که معادل $P(X \le 7 \text{ یا } X \ge 13)$ است.
    با توجه به اینکه $X$ از توزیع دوجمله‌ای $B(20, 0.5)$ پیروی می‌کند، این توزیع متقارن است. بنابراین $P(X \le 7) = P(X \ge 20-7) = P(X \ge 13)$.

    $$P(X \le 7) = \sum_{i=0}^{7} \binom{20}{i} (0.5)^{20}$$
    مجموع ضرایب دوجمله‌ای از $i=0$ تا $i=7$:
    $$\sum_{i=0}^{7} \binom{20}{i} = \binom{20}{0} + \binom{20}{1} + \dots + \binom{20}{7}$$   $$= 1 + 20 + 190 + 1140 + 4845 + 15504 + 38760 + 77520 = 137980$$
    پس:
    $$P(X \le 7) = 137980 \times (0.5)^{20} = 137980 \times \frac{1}{1048576} \approx 0.131589$$
    و در نتیجه $P(X \ge 13) \approx 0.131589$.

    احتمال کلی برابر است با:
    $$P(X < 8 \text{ یا } X > 12) = P(X \le 7) + P(X \ge 13) \approx 0.131589 + 0.131589 \approx 0.263178$$

#### **3.1.2**
فرض کنید که شما از تکنیک‌های Minhash استفاده می‌کنید و از 20 تابع هش برای هر مجموعه استفاده می‌کنید. فرض کنید یک دنباله از 20 پرتاب سکه مستقل دارید و احتمال اینکه سکه رو بیاید 0.5 است.

* **الف) احتمال اینکه دقیقاً 10 بار سکه رو بیاید چقدر است؟**

    **پاسخ:**
    این یک مسئله توزیع دوجمله‌ای با $n=20$ (تعداد پرتاب‌ها) و $p=0.5$ (احتمال رو آمدن سکه) است.
    اگر $Y$ تعداد دفعات رو آمدن سکه باشد، می‌خواهیم $P(Y=10)$ را محاسبه کنیم:
    $$P(Y=10) = \binom{20}{10} (0.5)^{10} (0.5)^{10} = \binom{20}{10} (0.5)^{20} \approx 0.176197$$
    (این نتیجه دقیقاً با بخش 3.1.1 الف یکسان است.)

* **ب) احتمال اینکه کمتر از 8 یا بیشتر از 12 بار سکه رو بیاید چقدر است؟**

    **پاسخ:**
    ما به دنبال $P(Y < 8 \text{ یا } Y > 12)$ هستیم که معادل $P(Y \le 7 \text{ یا } Y \ge 13)$ است.
    همانند بخش 3.1.1 ب:
    $$P(Y \le 7 \text{ یا } Y \ge 13) = P(Y \le 7) + P(Y \ge 13) \approx 0.131589 + 0.131589 \approx 0.263178$$
    (این نتیجه دقیقاً با بخش 3.1.1 ب یکسان است.)

* **ج) توضیح دهید که چگونه این سوال با سوال 3.1.1 مرتبط است.**

    **پاسخ:**
    هر دو سوال 3.1.1 و 3.1.2، از نظر ریاضی، به یک سناریوی یکسان اشاره دارند: یک دنباله از 20 آزمایش برنولی مستقل که در هر آزمایش، احتمال "موفقیت" 0.5 است.
    * در **3.1.1**، هر "آزمایش" یک تابع هش Minhash است که "موفق" محسوب می‌شود اگر مقادیر هش حداقل دو مجموعه برای آن تابع یکسان باشند. احتمال این موفقیت برابر با تشابه جاکارد (0.5) است.
    * در **3.1.2**، هر "آزمایش" یک پرتاب سکه است که "موفق" محسوب می‌شود اگر سکه "رو" بیاید. احتمال این موفقیت نیز 0.5 است.
    به همین دلیل، توزیع تعداد موفقیت‌ها در هر دو مورد (تعداد تطابق Minhash یا تعداد رو آمدن سکه) از توزیع دوجمله‌ای $B(n=20, p=0.5)$ پیروی می‌کند و محاسبات احتمال یکسان هستند. این ارتباط نشان می‌دهد که چگونه می‌توان پدیده Minhash و تخمین شباهت جاکارد را با استفاده از اصول پایه احتمالات درک کرد.

#### **3.1.3**
فرض کنید از طرح LSH (Locality-Sensitive Hashing) استفاده می‌کنید که 25 امضای Minhash را به 5 باند (bands) با 5 ردیف (rows) در هر باند تقسیم می‌کند. فرض کنید که حداقل یکی از جفت‌هایی که امضای Minhash آنها در همه ردیف‌های حداقل یک باند یکسان باشد را به عنوان یک "کاندید" شناسایی کنید.

* **پارامترهای LSH:**
    * تعداد کل امضاهای Minhash: $N = 25$
    * تعداد باندها: $b = 5$
    * تعداد ردیف‌ها در هر باند: $r = 5$
    * (توجه: $b \times r = 5 \times 5 = 25$ که برابر با تعداد کل امضاهای Minhash است.)

* **شرط شناسایی کاندید:**
    یک جفت کاندید شناسایی می‌شود اگر امضاهای Minhash آنها در **همه** $r$ ردیف **حداقل یک** باند یکسان باشند.

* **فرمول احتمال شناسایی کاندید ($f(s)$):**
    احتمال اینکه دو مجموعه با شباهت جاکارد $s$ به عنوان کاندید شناسایی شوند، با فرمول زیر داده می‌شود:
    $$f(s) = 1 - (1 - s^r)^b$$
    که در آن:
    * $s$: شباهت جاکارد
    * $r$: تعداد ردیف‌ها در هر باند
    * $b$: تعداد باندها

* **الف) احتمال شناسایی یک جفت با تشابه جاکارد 0.8 به عنوان کاندید چقدر است؟**

    **پاسخ:**
    با جایگذاری $s = 0.8$, $r = 5$, و $b = 5$ در فرمول:
    $$f(0.8) = 1 - (1 - (0.8)^5)^5$$
    ابتدا $(0.8)^5$ را محاسبه می‌کنیم:
    $$(0.8)^5 = 0.8 \times 0.8 \times 0.8 \times 0.8 \times 0.8 = 0.32768$$
    سپس عبارت داخل پرانتز را محاسبه می‌کنیم:
    $$1 - (0.8)^5 = 1 - 0.32768 = 0.67232$$
    حالا آن را به توان 5 می‌رسانیم:
    $$(0.67232)^5 \approx 0.135213$$
    و در نهایت:
    $$f(0.8) = 1 - 0.135213 = 0.864787$$
    بنابراین، احتمال شناسایی یک جفت با شباهت جاکارد 0.8 تقریباً **0.8648** است.

* **ب) احتمال شناسایی یک جفت با تشابه جاکارد 0.3 به عنوان کاندید چقدر است؟**

    **پاسخ:**
    با جایگذاری $s = 0.3$, $r = 5$, و $b = 5$ در فرمول:
    $$f(0.3) = 1 - (1 - (0.3)^5)^5$$
    ابتدا $(0.3)^5$ را محاسبه می‌کنیم:
    $$(0.3)^5 = 0.3 \times 0.3 \times 0.3 \times 0.3 \times 0.3 = 0.00243$$
    سپس عبارت داخل پرانتز را محاسبه می‌کنیم:
    $$1 - (0.3)^5 = 1 - 0.00243 = 0.99757$$
    حالا آن را به توان 5 می‌رسانیم:
    $$(0.99757)^5 \approx 0.98788$$
    و در نهایت:
    $$f(0.3) = 1 - 0.98788 = 0.01212$$
    بنابراین، احتمال شناسایی یک جفت با شباهت جاکارد 0.3 تقریباً **0.0121** است.

---

